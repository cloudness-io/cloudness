package vfavorite

import "github.com/cloudness-io/cloudness/types"
import "github.com/cloudness-io/cloudness/app/web/views/shared"
import "github.com/cloudness-io/cloudness/app/utils/routes"
import "strings"
import "github.com/cloudness-io/cloudness/app/web/views/components/icons"

templ ListPlaceholder(tenant *types.Tenant) {
	@shared.PageSection("Favorites", templ.NopComponent, templ.NopComponent) {
		@shared.PageContentShort() {
			@shared.LazyLoader("favorites", routes.TenantCtx(ctx)+"/favorites")
		}
	}
}

templ List(favs []*types.FavoriteDTO) {
	if len(favs) == 0 {
		<div class="grid px-6 py-14 lg:px-8">
			<div class="flex flex-col text-center space-y-2">
				<p>
					You do not have any favorites set. 
				</p>
				<p class="text-foreground-light">
					Set one by clicking on the star icon on appliaction page
				</p>
			</div>
		</div>
	} else {
		<div hx-push-url="true" hx-sync="#main:drop">
			@shared.Table() {
				@shared.TableHeadFull("Name", "Project", "Environment", "URL")
				@shared.TableBody() {
					for _, fav := range favs {
						@shared.TableBodyRow(templ.Attributes{"hx-get": routes.ApplicationProject(fav.ProjectUID, fav.EnvironmentUID, fav.ApplicationUID)}) {
							@shared.TableBodyCell() {
								<span class="text-foreground-light">{ fav.AppName }</span>
							}
							@shared.TableBodyCell() {
								<span class="text-foreground-light text-xs">{ fav.ProjectName }</span>
							}
							@shared.TableBodyCell() {
								<span class="text-foreground-light text-xs">{ fav.EnvironmentName }</span>
							}
							@shared.TableBodyCell() {
								<span onClick="event.stopPropagation();">
									if fav.AppDomain != "" {
										<a class="text-foreground-light hover:text-foreground inline-flex items-center gap-1 text-xs" href={ templ.SafeURL(fav.AppDomain) } target="_blank">
											<span class="truncate max-w-40 md:max-w-72 lg:max-w-96">{ trimProtocol(fav.AppDomain) }</span>
											@shared.Icon(icons.OutIcon, "size-3 shrink-0")
										</a>
									}
								</span>
							}
						}
					}
				}
			}
		</div>
	}
}

func trimProtocol(url string) string {
	url = strings.TrimPrefix(url, "https://")
	url = strings.TrimPrefix(url, "http://")
	return strings.TrimSuffix(url, "/")
}
